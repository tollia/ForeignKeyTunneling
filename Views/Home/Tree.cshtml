@using System.Data; 

@{
    ViewData["Title"] = "Index";
}

    <script type="text/javascript">
        $(function () {

            var jsondata = @Html.Raw(ViewBag.NodeListJSON);
            createJSTree(jsondata);
			
            $("#form").submit( function(eventObj) {
				var checked_ids = []; 
				var selectedNodes = $('#SimpleJSTree').jstree("get_checked", true);
				$.each(selectedNodes, function() {
					checked_ids.push(this.id);
				});
                if(checked_ids.length == 0) {
                    $("#message").text("You must select at least one column before pressing Select");
                    return false;
                }
                $('#colPathCSV').val(checked_ids);
                return true;
            });
			
        });

        //{
        //    id : "string" // will be autogenerated if omitted  
        //    text : "string" // node text  
        //    icon : "string" // string for custom  
        //    state : {  
        //        opened : boolean // is the node open  
        //        disabled : boolean // is the node disabled  
        //        selected : boolean // is the node selected  
        //    },  
        //    children : [] // array of strings or objects  
        //    li_attr : {} // attributes for the generated LI node  
        //    a_attr : {} // attributes for the generated A node  
        //}  
        function createJSTree(jsondata) {
            $('#SimpleJSTree').jstree({
                "core": {
                    "check_callback": true,
                    'data': jsondata                    
                },
				"checkbox" : {
					"keep_selected_style" : false,
                    "override_ui" : true,
                    "three_state" : false
				},
                "themes" : {
                    "theme" : "default",
                    "dots" : false,
                    "icons" : false
                },
                "plugins": ["wholerow", "checkbox", "themes"]
            });
        }
</script>

<div class="mb-2 row form-group">
    <div class="col-sm-12">
        <div id="SimpleJSTree"></div>
    </div>
</div>
<form id="form" method="post" asp-action="Select">
    <input id="colPathCSV" name="colPathCSV" type="hidden"/>
    <div class="mb-2 row form-group">
        <label class="col-sm-2 col-form-label">Maximum rows</label>
        <div class="col-sm-10">
            <input name="maxRecords" type="text" value="10" class="form-control"/>
        </div>
    </div>
    <div class="mb-2 row form-group">
        <div class="col-sm-12">
            <button type="submit" class="btn btn-primary float-end">Select</button>
        </div>
    </div>
    <div class="mb-2 row form-group">
        <div class="col-sm-12">
            <div id="message" class="align-content-center" style="color: red;"></div>
        </div>
    </div>
</form>

