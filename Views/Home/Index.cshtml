@using System.Data; 

@{
    ViewData["Title"] = "Index";
}

    <script type="text/javascript">
        $(function () {

            var jsondata = @Html.Raw(ViewBag.NodeListJSON);
            createJSTree(jsondata);
			
			$('.btnGetCheckedItem').click(function(){				
				var checked_ids = []; 
				var selectedNodes = $('#SimpleJSTree').jstree("get_checked", true);
				$.each(selectedNodes, function() {
					checked_ids.push(this.id);
				});
				// You can assign checked_ids to a hidden field of a form before submitting to the server
				$('#colPathCSV').text(checked_ids);
			});

            $("#form").submit( function(eventObj) {
				var checked_ids = []; 
				var selectedNodes = $('#SimpleJSTree').jstree("get_checked", true);
				$.each(selectedNodes, function() {
					checked_ids.push(this.id);
				});
                $('#colPathCSV').val(checked_ids);
                return true;
            });
			
        });

        //{
        //    id : "string" // will be autogenerated if omitted  
        //    text : "string" // node text  
        //    icon : "string" // string for custom  
        //    state : {  
        //        opened : boolean // is the node open  
        //        disabled : boolean // is the node disabled  
        //        selected : boolean // is the node selected  
        //    },  
        //    children : [] // array of strings or objects  
        //    li_attr : {} // attributes for the generated LI node  
        //    a_attr : {} // attributes for the generated A node  
        //}  
        function createJSTree(jsondata) {
            $('#SimpleJSTree').jstree({
                "core": {
                    "check_callback": true,
                    'data': jsondata                    
                },
				"checkbox" : {
					"keep_selected_style" : false,
                    "override_ui" : true,
                    "three_state" : false
				},
                "themes" : {
                    "theme" : "default",
                    "dots" : false,
                    "icons" : false
                },
                "plugins": ["wholerow", "checkbox", "themes"]
            });
        }
</script>

<div id="SimpleJSTree"></div>
<form id="form" method="post" asp-action="Select" onsubmit="">
    <input id="colPathCSV" name="colPathCSV" type="hidden" />
    <input type="submit" value="Select"/>
</form>

